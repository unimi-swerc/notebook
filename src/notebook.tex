\documentclass[8pt,a4paper,landscape,oneside]{amsart}
\usepackage[utf8]{inputenc}

\usepackage{amsmath, amsthm, amssymb, amsfonts}
\usepackage[italian]{babel}
\usepackage[scaled]{beramono}
\usepackage{booktabs}
\usepackage{caption}
\usepackage{color}
\usepackage{datetime}
\usepackage{enumitem}
\usepackage{fancyhdr}
\usepackage{float}
\usepackage{fullpage}
\usepackage[top=3pt, bottom=1cm, left=0.3cm, right=0.3cm]{geometry}
\usepackage{graphicx}
\usepackage{lmodern}
\usepackage[cache=false]{minted}
\usepackage{multicol}
\usepackage{subcaption}
\usepackage{titling}
\usepackage{luacode}

\newcommand{\subtitle}[1]{\posttitle{\par\end{center}\begin{center}\large#1\end{center}\vskip0.1em\vspace{-1em}}}

% Minted
\newcommand{\codecpp}[1]{\inputminted[fontsize=\normalsize,baselinestretch=1,xleftmargin=2.5em,linenos]{cpp}{#1}}
\newcommand{\codepy}[1]{\inputminted[fontsize=\normalsize,baselinestretch=1,xleftmargin=2.5em,linenos]{python}{#1}}

% Header/Footer
\pagestyle{fancy}
\lhead{Università degli Studi di Milano - LaStatale Yellow}
\rhead{\thepage}
\cfoot{}
\setlength{\headheight}{15.2pt}
\setlength{\droptitle}{-20pt}
\posttitle{\par\end{center}}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

% Math and bit operators
\DeclareMathOperator{\lcm}{lcm}
\newcommand*\BitAnd{\mathrel{\&}}
\newcommand*\BitOr{\mathrel{|}}
\newcommand*\ShiftLeft{\ll}
\newcommand*\ShiftRight{\gg}
\newcommand*\BitNeg{\ensuremath{\mathord{\sim}}}
\DeclareRobustCommand{\stirling}{\genfrac\{\}{0pt}{}}

% Title/Author
\author{LaStatale Yellow 2021-2022}
\title{Università degli Studi di Milano - LaStatale Yellow}
\subtitle{Team Reference Document}
\date{\ddmmyyyydate{\today{}}}

\begin{document}
\begin{multicols*}{3}
\maketitle
\thispagestyle{fancy}
\vspace{-3em}
\tableofcontents

\begin{luacode*}

current_dir = lfs.currentdir() .. "/src"
sorted_section = {}
for section in lfs.dir(current_dir) do
  table.insert(sorted_section, section)
end
table.sort(sorted_section)
for ind1, section in ipairs(sorted_section) do
    if not section:find("%.") then
        section_dir = current_dir .. "/" .. section
        tex.print("\\section{" .. section .. "}")
        sorted_subsection = {}
        for subsection in lfs.dir(section_dir) do
          table.insert(sorted_subsection, subsection)
        end
        table.sort(sorted_subsection)
        for ind2, subsection in ipairs(sorted_subsection) do
            if subsection:find("%.cpp$") and not subsection:find("%.test%.cpp$") then
                subsection_dir = section_dir .. "/" .. subsection
                tex.print("\\subsection{" .. subsection:sub(1,subsection:len()-4) .. "}")
                tex.print("\\codecpp{" .. subsection_dir:gsub("%s", "\\%1") .. "}")
            end
            if subsection:find("%.py$") then
                subsection_dir = section_dir .. "/" .. subsection
                tex.print("\\subsection{" .. subsection:sub(1,subsection:len()-3) .. "}")
                tex.print("\\codepy{" .. subsection_dir:gsub("%s", "\\%1") .. "}")
            end
            if subsection:find("%.tex$") then
                subsection_dir = section_dir .. "/" .. subsection
                tex.print("\\subsection{" .. subsection:sub(1,subsection:len()-4) .. "}")
                gg = io.open(subsection_dir, "r")
                tex.print(string.split(gg:read("*a"),"\n"))
            end
        end
    end
end

\end{luacode*}


\end{multicols*}
\end{document}
